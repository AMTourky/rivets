<!DOCTYPE html>

<html>
<head>
  <title>binders.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="adapters.html">
                adapters.coffee
              </a>
            
              
              <a class="source" href="binders.html">
                binders.coffee
              </a>
            
              
              <a class="source" href="bindings.html">
                bindings.coffee
              </a>
            
              
              <a class="source" href="export.html">
                export.coffee
              </a>
            
              
              <a class="source" href="keypath_observer.html">
                keypath_observer.coffee
              </a>
            
              
              <a class="source" href="parsers.html">
                parsers.coffee
              </a>
            
              
              <a class="source" href="rivets.html">
                rivets.coffee
              </a>
            
              
              <a class="source" href="util.html">
                util.coffee
              </a>
            
              
              <a class="source" href="view.html">
                view.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>binders.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>Core binders that are included with Rivets.js.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Rivets.binders.<span class="function"><span class="title">enabled</span></span> = (el, value) -&gt;
  el.disabled = !value

Rivets.binders.<span class="function"><span class="title">disabled</span></span> = (el, value) -&gt;
  el.disabled = !!value

Rivets.binders.checked =
  publishes: <span class="literal">true</span>
  bind: (el) -&gt;
    Rivets.Util.bindEvent el, <span class="string">'change'</span>, <span class="property">@publish</span>
  unbind: (el) -&gt;
    Rivets.Util.unbindEvent el, <span class="string">'change'</span>, <span class="property">@publish</span>
  routine: (el, value) -&gt;
    <span class="keyword">if</span> el.type <span class="keyword">is</span> <span class="string">'radio'</span>
      el.checked = el.value?.toString() <span class="keyword">is</span> value?.toString()
    <span class="keyword">else</span>
      el.checked = !!value

Rivets.binders.unchecked =
  publishes: <span class="literal">true</span>
  bind: (el) -&gt;
    Rivets.Util.bindEvent el, <span class="string">'change'</span>, <span class="property">@publish</span>
  unbind: (el) -&gt;
    Rivets.Util.unbindEvent el, <span class="string">'change'</span>, <span class="property">@publish</span>
  routine: (el, value) -&gt;
    <span class="keyword">if</span> el.type <span class="keyword">is</span> <span class="string">'radio'</span>
      el.checked = el.value?.toString() <span class="keyword">isnt</span> value?.toString()
    <span class="keyword">else</span>
      el.checked = !value

Rivets.binders.<span class="function"><span class="title">show</span></span> = (el, value) -&gt;
  el.style.display = <span class="keyword">if</span> value <span class="keyword">then</span> <span class="string">''</span> <span class="keyword">else</span> <span class="string">'none'</span>

Rivets.binders.<span class="function"><span class="title">hide</span></span> = (el, value) -&gt;
  el.style.display = <span class="keyword">if</span> value <span class="keyword">then</span> <span class="string">'none'</span> <span class="keyword">else</span> <span class="string">''</span>

Rivets.binders.<span class="function"><span class="title">html</span></span> = (el, value) -&gt;
  el.innerHTML = <span class="keyword">if</span> value? <span class="keyword">then</span> value <span class="keyword">else</span> <span class="string">''</span>

Rivets.binders.value =
  publishes: <span class="literal">true</span>
  bind: (el) -&gt;
    Rivets.Util.bindEvent el, <span class="string">'change'</span>, <span class="property">@publish</span>
  unbind: (el) -&gt;
    Rivets.Util.unbindEvent el, <span class="string">'change'</span>, <span class="property">@publish</span>
  routine: (el, value) -&gt;
    <span class="keyword">if</span> window.jQuery?
      el = jQuery el

      <span class="keyword">if</span> value?.toString() <span class="keyword">isnt</span> el.val()?.toString()
        el.val <span class="keyword">if</span> value? <span class="keyword">then</span> value <span class="keyword">else</span> <span class="string">''</span>
    <span class="keyword">else</span>
      <span class="keyword">if</span> el.type <span class="keyword">is</span> <span class="string">'select-multiple'</span>
        o.selected = o.value <span class="keyword">in</span> value <span class="keyword">for</span> o <span class="keyword">in</span> el <span class="keyword">if</span> value?
      <span class="keyword">else</span> <span class="keyword">if</span> value?.toString() <span class="keyword">isnt</span> el.value?.toString()
        el.value = <span class="keyword">if</span> value? <span class="keyword">then</span> value <span class="keyword">else</span> <span class="string">''</span>

Rivets.binders.<span class="function"><span class="title">text</span></span> = (el, value) -&gt;
  <span class="keyword">if</span> el.innerText?
    el.innerText = <span class="keyword">if</span> value? <span class="keyword">then</span> value <span class="keyword">else</span> <span class="string">''</span>
  <span class="keyword">else</span>
    el.textContent = <span class="keyword">if</span> value? <span class="keyword">then</span> value <span class="keyword">else</span> <span class="string">''</span>

Rivets.binders.<span class="keyword">if</span> =
  block: <span class="literal">true</span>

  bind: (el) -&gt;
    <span class="keyword">unless</span> <span class="property">@marker</span>?
      attr = [<span class="property">@view</span>.config.prefix, <span class="property">@type</span>].join(<span class="string">'-'</span>).replace <span class="string">'--'</span>, <span class="string">'-'</span>
      declaration = el.getAttribute attr

      <span class="property">@marker</span> = document.createComment <span class="string">" rivets: <span class="subst">#{@type}</span> <span class="subst">#{declaration}</span> "</span>

      el.removeAttribute attr
      el.parentNode.insertBefore <span class="property">@marker</span>, el
      el.parentNode.removeChild el

  unbind: -&gt;
    <span class="property">@nested</span>?.unbind()

  routine: (el, value) -&gt;
    <span class="keyword">if</span> !!value <span class="keyword">is</span> <span class="keyword">not</span> <span class="property">@nested</span>?
      <span class="keyword">if</span> value
        models = {}
        models[key] = model <span class="keyword">for</span> key, model <span class="keyword">of</span> <span class="property">@view</span>.models

        options =
          binders: <span class="property">@view</span>.options.binders
          formatters: <span class="property">@view</span>.options.formatters
          adapters: <span class="property">@view</span>.options.adapters
          config: <span class="property">@view</span>.options.config

        (<span class="property">@nested</span> = <span class="keyword">new</span> Rivets.View(el, models, options)).bind()
        <span class="property">@marker</span>.parentNode.insertBefore el, <span class="property">@marker</span>.nextSibling
      <span class="keyword">else</span>
        el.parentNode.removeChild el
        <span class="property">@nested</span>.unbind()
        <span class="keyword">delete</span> <span class="property">@nested</span>

  update: (models) -&gt;
    <span class="property">@nested</span>?.update models

Rivets.binders.<span class="keyword">unless</span> =
  block: <span class="literal">true</span>

  bind: (el) -&gt;
    Rivets.binders.<span class="keyword">if</span>.bind.call @, el

  unbind: -&gt;
    Rivets.binders.<span class="keyword">if</span>.unbind.call @

  routine: (el, value) -&gt;
    Rivets.binders.<span class="keyword">if</span>.routine.call @, el, <span class="keyword">not</span> value

  update: (models) -&gt;
    Rivets.binders.<span class="keyword">if</span>.update.call @, models

Rivets.binders[<span class="string">'on-*'</span>] =
  <span class="reserved">function</span>: <span class="literal">true</span>

  unbind: (el) -&gt;
    Rivets.Util.unbindEvent el, <span class="property">@args</span>[<span class="number">0</span>], <span class="property">@handler</span> <span class="keyword">if</span> <span class="property">@handler</span>

  routine: (el, value) -&gt;
    Rivets.Util.unbindEvent el, <span class="property">@args</span>[<span class="number">0</span>], <span class="property">@handler</span> <span class="keyword">if</span> <span class="property">@handler</span>
    Rivets.Util.bindEvent el, <span class="property">@args</span>[<span class="number">0</span>], <span class="property">@handler</span> = <span class="property">@eventHandler</span> value

Rivets.binders[<span class="string">'each-*'</span>] =
  block: <span class="literal">true</span>

  bind: (el) -&gt;
    <span class="keyword">unless</span> <span class="property">@marker</span>?
      attr = [<span class="property">@view</span>.config.prefix, <span class="property">@type</span>].join(<span class="string">'-'</span>).replace <span class="string">'--'</span>, <span class="string">'-'</span>
      <span class="property">@marker</span> = document.createComment <span class="string">" rivets: <span class="subst">#{@type}</span> "</span>
      <span class="property">@iterated</span> = []

      el.removeAttribute attr
      el.parentNode.insertBefore <span class="property">@marker</span>, el
      el.parentNode.removeChild el

  unbind: (el) -&gt;
    view.unbind() <span class="keyword">for</span> view <span class="keyword">in</span> <span class="property">@iterated</span> <span class="keyword">if</span> <span class="property">@iterated</span>?

  routine: (el, collection) -&gt;
    modelName = <span class="property">@args</span>[<span class="number">0</span>]
    collection = collection <span class="keyword">or</span> []

    <span class="keyword">if</span> <span class="property">@iterated</span>.length &gt; collection.length
      <span class="keyword">for</span> i <span class="keyword">in</span> Array <span class="property">@iterated</span>.length - collection.length
        view = <span class="property">@iterated</span>.pop()
        view.unbind()
        <span class="property">@marker</span>.parentNode.removeChild view.els[<span class="number">0</span>]

    <span class="keyword">for</span> model, index <span class="keyword">in</span> collection
      data = {}
      data[modelName] = model

      <span class="keyword">if</span> <span class="keyword">not</span> <span class="property">@iterated</span>[index]?
        <span class="keyword">for</span> key, model <span class="keyword">of</span> <span class="property">@view</span>.models
          data[key] ?= model

        previous = <span class="keyword">if</span> <span class="property">@iterated</span>.length
          <span class="property">@iterated</span>[<span class="property">@iterated</span>.length - <span class="number">1</span>].els[<span class="number">0</span>]
        <span class="keyword">else</span>
          <span class="property">@marker</span>

        options =
          binders: <span class="property">@view</span>.options.binders
          formatters: <span class="property">@view</span>.options.formatters
          adapters: <span class="property">@view</span>.options.adapters
          config: {}

        options.config[k] = v <span class="keyword">for</span> k, v <span class="keyword">of</span> <span class="property">@view</span>.options.config
        options.config.preloadData = <span class="literal">true</span>

        template = el.cloneNode <span class="literal">true</span>
        view = <span class="keyword">new</span> Rivets.View(template, data, options)
        view.bind()
        <span class="property">@iterated</span>.push view

        <span class="property">@marker</span>.parentNode.insertBefore template, previous.nextSibling
      <span class="keyword">else</span> <span class="keyword">if</span> <span class="property">@iterated</span>[index].models[modelName] <span class="keyword">isnt</span> model
        <span class="property">@iterated</span>[index].update data

    <span class="keyword">if</span> el.nodeName <span class="keyword">is</span> <span class="string">'OPTION'</span>
      <span class="keyword">for</span> binding <span class="keyword">in</span> <span class="property">@view</span>.bindings
        <span class="keyword">if</span> binding.el <span class="keyword">is</span> <span class="property">@marker</span>.parentNode <span class="keyword">and</span> binding.type <span class="keyword">is</span> <span class="string">'value'</span>
          binding.sync()

  update: (models) -&gt;
    data = {}
    
    <span class="keyword">for</span> key, model <span class="keyword">of</span> models
      data[key] = model <span class="keyword">unless</span> key <span class="keyword">is</span> <span class="property">@args</span>[<span class="number">0</span>]

    view.update data <span class="keyword">for</span> view <span class="keyword">in</span> <span class="property">@iterated</span>

Rivets.binders[<span class="string">'class-*'</span>] = (el, value) -&gt;
  elClass = <span class="string">" <span class="subst">#{el.className}</span> "</span>

  <span class="keyword">if</span> !value <span class="keyword">is</span> (elClass.indexOf(<span class="string">" <span class="subst">#{@args[<span class="number">0</span>]}</span> "</span>) <span class="keyword">isnt</span> -<span class="number">1</span>)
    el.className = <span class="keyword">if</span> value
      <span class="string">"<span class="subst">#{el.className}</span> <span class="subst">#{@args[<span class="number">0</span>]}</span>"</span>
    <span class="keyword">else</span>
      elClass.replace(<span class="string">" <span class="subst">#{@args[<span class="number">0</span>]}</span> "</span>, <span class="string">' '</span>).trim()

Rivets.binders[<span class="string">'*'</span>] = (el, value) -&gt;
  <span class="keyword">if</span> value
    el.setAttribute <span class="property">@type</span>, value
  <span class="keyword">else</span>
    el.removeAttribute <span class="property">@type</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
