// Generated by CoffeeScript 1.3.1
(function() {
  var attributeBinding, bidirectionals, bindings, getInputValue, registerBinding, rivets, stateBinding,
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  registerBinding = function(el, adapter, type, context, keypath) {
    var bind;
    bind = bindings[type] || attributeBinding(type);
    bind(el, adapter.read(context, keypath));
    adapter.subscribe(context, keypath, function(value) {
      return bind(el, value);
    });
    if (__indexOf.call(bidirectionals, type) >= 0) {
      return el.addEventListener('change', function() {
        return adapter.publish(context, keypath, getInputValue(this));
      });
    }
  };

  getInputValue = function(el) {
    switch (el.type) {
      case 'text':
      case 'textarea':
      case 'password':
      case 'select-one':
        return el.value;
      case 'checkbox':
        return el.checked;
    }
  };

  attributeBinding = function(attr) {
    return function(el, value) {
      if (value) {
        return el.setAttribute(attr, value);
      } else {
        return el.removeAttribute(attr);
      }
    };
  };

  stateBinding = function(attr, inverse) {
    if (inverse == null) {
      inverse = false;
    }
    return function(el, value) {
      return attributeBinding(attr)(el, inverse === !value ? attr : false);
    };
  };

  bindings = {
    checked: stateBinding('checked'),
    selected: stateBinding('selected'),
    disabled: stateBinding('disabled'),
    unchecked: stateBinding('checked', true),
    unselected: stateBinding('selected', true),
    enabled: stateBinding('disabled', true),
    text: function(el, value) {
      return el.innerText = value || '';
    },
    html: function(el, value) {
      return el.innerHTML = value || '';
    },
    value: function(el, value) {
      return el.value = value;
    },
    show: function(el, value) {
      return el.style.display = value ? '' : 'none';
    },
    hide: function(el, value) {
      return el.style.display = value ? 'none' : '';
    }
  };

  bidirectionals = ['value', 'checked', 'unchecked', 'selected', 'unselected'];

  rivets = {
    bind: function(el, adapter, contexts) {
      var nodes, _i, _ref, _results;
      if (contexts == null) {
        contexts = {};
      }
      nodes = el.getElementsByTagName('*');
      return (function() {
        _results = [];
        for (var _i = 0, _ref = nodes.length - 1; 0 <= _ref ? _i <= _ref : _i >= _ref; 0 <= _ref ? _i++ : _i--){ _results.push(_i); }
        return _results;
      }).apply(this).forEach(function(n) {
        var node, _i, _ref, _results;
        node = nodes[n];
        if (node.attributes.length > 0) {
          return (function() {
            _results = [];
            for (var _i = 0, _ref = node.attributes.length - 1; 0 <= _ref ? _i <= _ref : _i >= _ref; 0 <= _ref ? _i++ : _i--){ _results.push(_i); }
            return _results;
          }).apply(this).forEach(function(n) {
            var attribute, context, keypath, path, type;
            attribute = node.attributes[n];
            if (/^data-/.test(attribute.name)) {
              type = attribute.name.replace('data-', '');
              path = attribute.value.split('.');
              context = path.shift();
              keypath = path.join('.');
              return registerBinding(node, adapter, type, contexts[context], keypath);
            }
          });
        }
      });
    }
  };

  if (typeof module !== "undefined" && module !== null) {
    module.exports = rivets;
  } else {
    this.rivets = rivets;
  }

}).call(this);
